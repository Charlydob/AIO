<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Vida • Finanzas</title>
  <link rel="stylesheet" href="css/opal.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Firebase compat (NO ESM) -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>

<!-- Tu init + utilidades -->
<script src="js/firebase-init.js"></script>
<script src="js/utils.js"></script>

</head>
<body>
<header class="app-bar">
  <button class="icon-btn" onclick="history.back()">←</button>
  <h1>Finanzas</h1>
  <button class="pill" onclick="Fin.showAdd()">＋</button>
</header>

<main class="page">
  <!-- Subpestañas internas -->
  <div class="tabs">
    <button class="tab active" data-tab="overview" onclick="Fin.switchTab('overview')">Resumen</button>
    <button class="tab" data-tab="entries" onclick="Fin.switchTab('entries')">Movimientos</button>
    <button class="tab" data-tab="analytics" onclick="Fin.switchTab('analytics')">Analítica</button>
  </div>

  <section id="tab-overview" class="view active">
    <div class="sheet">
      <div class="stats row wrap">
        <div class="stat"><div class="label">Patrimonio</div><div id="stNet" class="value">0 €</div></div>
        <div class="stat"><div class="label">Ingresos (30d)</div><div id="stInc" class="value">0 €</div></div>
        <div class="stat"><div class="label">Gastos (30d)</div><div id="stExp" class="value">0 €</div></div>
        <div class="stat"><div class="label">% Inversión / Salario</div><div id="stInvPct" class="value">0 %</div></div>
      </div>
      <h3>Evolución patrimonio</h3>
      <canvas id="netWorthChart" height="200"></canvas>
    </div>
  </section>

  <section id="tab-entries" class="view">
    <div class="sheet">
      <div class="filters row wrap">
        <select id="fType" onchange="Fin.renderEntries()">
          <option value="">Tipo: todos</option>
          <option value="ingreso">Ingreso</option>
          <option value="gasto">Gasto</option>
          <option value="salario">Salario</option>
          <option value="inversion">Inversión</option>
        </select>
        <select id="fCat" onchange="Fin.renderEntries()">
          <option value="">Categoría</option>
          <option>Comida</option><option>Transporte</option><option>Casa</option>
          <option>Ocio</option><option>Salud</option><option>Otros</option>
        </select>
      </div>
      <div id="entriesList" class="card-column"></div>
    </div>
  </section>

  <section id="tab-analytics" class="view">
    <div class="sheet">
      <h3>Ingresos vs Gastos</h3>
      <canvas id="incExpChart" height="200"></canvas>
      <h3>Gasto por categoría (últimos 30d)</h3>
      <canvas id="catPieChart" height="200"></canvas>
    </div>
  </section>

  <!-- Editor “página dentro de página” -->
  <section id="entry-editor" class="view">
    <div class="sheet">
      <h2 id="edTitle">Nuevo movimiento</h2>
      <label class="field"><span>Tipo</span>
        <select id="eType">
          <option value="ingreso">Ingreso</option>
          <option value="gasto">Gasto</option>
          <option value="salario">Salario</option>
          <option value="inversion">Inversión</option>
        </select>
      </label>
      <label class="field"><span>Categoría</span>
        <select id="eCat">
          <option>Comida</option><option>Transporte</option><option>Casa</option>
          <option>Ocio</option><option>Salud</option><option>Otros</option>
        </select>
      </label>
      <label class="field"><span>Fecha</span><input id="eDate" type="date"/></label>
      <label class="field"><span>Importe (€)</span><input id="eAmount" type="number" step="0.01"/></label>
      <label class="field"><span>Notas</span><input id="eNote" /></label>
      <div class="row">
        <button class="pill ghost" onclick="Fin.closeEditor()">Cancelar</button>
        <div class="grow"></div>
        <button id="eDelete" class="pill danger hidden" onclick="Fin.deleteEntry()">Borrar</button>
        <button class="pill" onclick="Fin.saveEntry()">Guardar</button>
      </div>
    </div>
  </section>
</main>

<nav class="bottom-nav">
  <a href="index.html">Inicio</a>
  <a href="timers.html">Tempos</a>
  <a href="notas.html">Notas</a>
  <a href="finanzas.html" class="active">Finanzas</a>
</nav>

<script src="js/finanzas.js"></script>
</body>
</html>
